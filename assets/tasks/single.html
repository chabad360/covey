{{ define "main" }}
<div class="container-fluid">
        <div class="card">
            <div class="card-header">Task</div>
            <div class="card-body">
            <table class="table table-bordered">
                <colgroup>
                    <col span="1" style="width: 10%;">
                    <col span="1" style="width: 50%;">
                    <col span="1" style="width: 10%;">
                    <col span="1" style="width: 30%;">
                </colgroup>
                <tbody>
                    <tr>
                        <th scope="row">ID</th>
                        <td>{{ .Details.Task.GetID }}</td>
                        <th scope="row">Node</th>
                        <td><a href="/nodes/{{ .Details.Task.GetNode }}">{{ .Details.Task.GetNode }}</a></td>
                    </tr>
                    <tr>
                        <th scope="row">Date</th>
                        <td>{{ .Details.Task.GetTime.Format "01/02/2006" }}</td>
                        <th scope="row">Time</th>
                        <td>{{ .Details.Task.GetTime.Format "15:04:05" }}</td>
                    </tr>
                    <tr>
                        <th scope="row">State</th>
                        <td>
                        {{- with .Details.Task.GetState -}}
                        {{- if eq . 0 -}}
                        <span class="badge bg-danger">Failed</span>
                        {{- else if eq . 1 -}}
                        <span class="badge bg-success">Done</span>
                        {{- else if eq . 2 -}}
                        <span class="badge bg-warning">Running</span>
                        {{- else if eq . 3 -}}
                        <span class="badge bg-secondary">Stopped</span>
                        {{- end -}}
                        {{- end -}}
                        </td>
                        <th scope="row">Plugin</th>
                        <td>{{ .Details.Task.GetPlugin }}</td>
                    </tr>
                </tbody>
            </table>
            </div>
        </div>
        <div class="card">
            <div class="card-header">Details</div>
            <div class="card-body">
            <table class="table table-bordered">
                <tbody>
                    {{ range $key, $val := .Details.Task.Details }}
                    <tr>
                        <th scope="row">{{ title $key }}</th>
                        <td><code>{{ $val }}</code></td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
            </div>
        </div>
        <div class="card">
            <div class="card-header">Log</div>
            <div class="card-body">
            <div id="log" class="overflow-auto" style="height: 100%"><pre>
            {{- range .Details.Task.GetLog -}}
                <samp>{{ . }}</samp><br />
            {{- else -}}
                <samp>No Logs Yet</samp>
            {{- end -}}
            </pre></div>
            </div>
        </div>
</div>
{{ end }}

{{ define "scripts" }} 
{{ if eq .Details.Task.GetState 2 }}
<script type="text/javascript">
function startRefresh() {
    $.get('', function(data) {
        $(document.body).html(data);    
    });
}
$(function() {
    setTimeout(startRefresh,1000);
});
</script>
{{ end }}
{{ end }}
